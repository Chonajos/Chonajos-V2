<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../templates/main.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="content" id="content">
        <p:ajaxStatus onsuccess="PF('statusDialog').hide()" />
        <p:dialog widgetVar="statusDialog" modal="true" draggable="false"
                  closable="false" resizable="false" showHeader="false">
            <p:graphicImage value="../resources/img/carga.gif" />
        </p:dialog>
        <div>
            <h3>#{beanEntregaMercancia.title}</h3>
        </div>
        <h:form id="formContent" style="padding-left: 0px;">
            <p:remoteCommand id="remoteComman" resetValues="true" onstart="alert('onstart')"></p:remoteCommand>
            <p:messages id="messages" showDetail="true" showSummary="false" autoUpdate="true" closable="true" />
            <p:panel style="padding:0px !important;">
                <div class="container-fluid" style="padding: 0px;">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group" style="padding: 0px;">
                        <p:outputLabel value="Folio de venta:" class="col-lg-1 col-md-2 col-sm-3 col-xs-12 " for="txtFolioVenta" style="padding-left: 0px;" />
                        <p:inputText id="txtFolioVenta" value ="#{beanEntregaMercancia.data.idFolioVenta}"  maxlength="10" class="col-lg-1 col-md-2 col-sm-2 col-xs-12" >
                            <pe:keyFilter regEx="/[0-9.]/i"/>
                        </p:inputText>
                        <div class="col-lg-8">
                            <p:commandButton  value="Buscar" class="primaryButton" update=":formContent" action="#{beanEntregaMercancia.buscaFolioVenta}" style="margin-left:30px; " onclick="PF('statusDialog').show()"/>
                        </div>
                        <p:commandButton  value="Entregar" class="primaryButton" update=":formContent" action="#{beanEntregaMercancia.print}" style="margin-left:30px; " onclick="PF('statusDialog').show()"/>

                    </div>
                    <div class="col-lg-12 col-md-12 col-md-12 col-xs-12 form-group" style="padding: 0px;">
                        <p:outputLabel value="Cliente:" class="col-lg-1 col-md-3 col-sm-3 col-xs-12" for="txtCliente" style="padding-left: 0px;"/>
                        <p:inputText id="txtCliente" value="#{beanEntregaMercancia.data.nombreCliente}" class="col-lg-2 col-md-3 col-sm-3 col-xs-12" readonly="true"/>
                        <p:outputLabel value="Total Venta:" class="col-lg-1 col-md-3 col-sm-3 col-xs-12" for="txtTotalVenta" style="padding-left: 0px;"/>
                        <p:inputText id="txtTotalVenta"  value="#{beanEntregaMercancia.data.totalVenta}"  class="col-lg-1 col-md-3 col-sm-3 col-xs-12" >
                            <!--<f:converter converterId="bigDecimalConverter" />-->
                        </p:inputText>
                        <p:outputLabel value="Tipo Venta:" class="col-lg-1 col-md-3 col-sm-3 col-xs-12" for="txtTipoVenta" style="padding-left: 0px;"/>
                        <p:inputText id="txtTipoVenta" value="#{beanEntregaMercancia.data.nombreTipoVenta}" class="col-lg-1 col-md-3 col-sm-3 col-xs-12" readonly="true"/>
                        <p:outputLabel value="Estatus Venta:" class="col-lg-1 col-md-3 col-sm-3 col-xs-12" for="txtEstatusVenta" style="padding-left: 5px; padding-right:8px; "/>
                        <p:inputText id="txtEstatusVenta" value="#{beanEntregaMercancia.data.estatusVenta}" class="col-lg-1 col-md-3 col-sm-3 col-xs-12" readonly="true"/>
                        <p:outputLabel class="col-lg-1 col-md-3 col-sm-3 col-xs-12" id="codigo" for="txtCodigoBarras" value ="CÃ³digo de Barras:"  rendered="#{beanEntregaMercancia.usuarioDominio.sucId ==1}"/> 
                        <p:inputText id="txtCodigoBarras" maxlength="30" class="col-lg-1 col-md-3 col-sm-3 col-xs-12"  value="#{beanEntregaMercancia.codigoBarras}" rendered="#{beanEntregaMercancia.usuarioDominio.sucId==1}">
                        <p:ajax event="blur" update=":formContent" listener ="#{beanEntregaMercancia.searchByBarCode()}"/>
                        </p:inputText>
                         <p:outputLabel value="Cantidad:" class="col-lg-1 col-md-3 col-sm-3 col-xs-12" for="txtCantidad" style="padding-left: 0px;"/>
                        <p:inputText id="txtCantidad" value="#{beanEntregaMercancia.cantidad}" class="col-lg-1 col-md-3 col-sm-3 col-xs-12"/>
                        

                    </div>
                    <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12 col-lg-offset-1 col-md-offset-1" style="padding: 0px;">
                        <p:dataTable id="table" var="model" value="#{beanEntregaMercancia.model}" styleClass="ui-datatable-hor-scroll"
                                     emptyMessage="No se encontraron Registros." scrollable="true" scrollHeight="280">
                            <p:column width="15px;">
                                <p:rowToggler/>
                            </p:column>
                            <p:column  headerText="Carro" width="50px;" class="alignCenter">
                                <h:outputText value="#{model.idCarroFk}">
                                </h:outputText>
                            </p:column>
                            <p:column  headerText="Producto" width="100px;" class="alignLeft">
                                <h:outputText value="#{model.nombreProducto}">
                                </h:outputText>
                            </p:column>
                            <p:column  headerText="Empaque" width="100px;" class="alignLeft">
                                <h:outputText value="#{model.nombreEmpaque}">
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Empaques por Entregar" width="80px;" class="alignRight">
                                <h:outputText value="#{model.empaquesRemanente-model.empaquesEntregados}" >
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Kilos por Entregar" width="80px;" class="alignRight">
                                <h:outputText value="#{model.kilosRemanente-model.kilosEntregados}" />
                            </p:column>
                            <p:column headerText="Empaques Entregados" width="100px;" class="alignRight">
                                <h:outputText value="#{model.empaquesEntregados}" />
                            </p:column>
                            <p:column headerText="Kilos Entregados" width="100px;" class="alignRight">
                                <h:outputText value="#{model.kilosEntregados}">
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Entregar"  width="60px;" class="alignCenter">
                                <p:commandButton icon="ui-icon-transferthick-e-w" onclick ="PF('dlg').show();" action="#{beanEntregaMercancia.setValues}" update=":formContent:panelGrid" disabled="#{!beanEntregaMercancia.permisosEntrega || (model.empaquesRemanente -model.empaquesEntregados == 0) }" >
                                    <f:setPropertyActionListener target="#{beanEntregaMercancia.entregaMercancia}" value="${model}" />
                                </p:commandButton>
                            </p:column>
                            <p:rowExpansion>
                                <p:dataTable id="table" var="modelEntregado" value="#{model.lstEntregaMercancia}" styleClass="ui-datatable-hor-scroll seconTable" rowKey="#{modelEntregado.idEntregaMercanciaPk}"
                                             emptyMessage="No se Encontraron Registros." scrollable="true" >
                                    <p:column headerText="Usuario que entrego">
                                        <h:outputText value="#{modelEntregado.nombreUsuarioEntrega}"/>
                                    </p:column>
                                    <p:column headerText="Fecha de Entrega">
                                        <h:outputText value="#{modelEntregado.fechaStr}"/>
                                    </p:column>
                                    <p:column headerText="Cajas/Bultos Entregados" class="alignRight">
                                        <h:outputText value="#{modelEntregado.empaquesEntregados}"/>
                                    </p:column>
                                    <p:column headerText="Kilos Entregados" class="alignRight">
                                        <h:outputText value="#{modelEntregado.kilosEntregados}"/>
                                    </p:column>
                                    <p:column headerText="Comentarios">
                                        <h:outputText value="#{modelEntregado.observaciones}"/>
                                    </p:column>

                                </p:dataTable>


                            </p:rowExpansion>
                        </p:dataTable>
                    </div>
                </div>
            </p:panel>
            <p:dialog  id="dialogw" header="Entregar" widgetVar="dlg" resizable="false">
                <h:panelGrid id="panelGrid" columns="1" cellpadding="5">
                    <f:facet name="header">
                        <div class="form-group alignRight">
                            <p:commandButton value="Aceptar" action="#{beanEntregaMercancia.agregarEntrega}" onclick="PF('statusDialog').show()"/>
                        </div>
                    </f:facet> 
                    <p:outputLabel  for="txtProducto" value ="Producto:" /> 
                    <p:inputText  id="txtProducto" value="#{beanEntregaMercancia.entregaMercancia.nombreProducto}" readonly="true"/>
                    <h:outputLabel for="txtEmpaquesRestantes" value="Empaques Restantes:" />
                    <p:inputText id="txtEmpaquesRestantes" maxlength="10" value="#{beanEntregaMercancia.entregaMercancia.empaquesRemanente-beanEntregaMercancia.entregaMercancia.empaquesEntregados}" readonly="true"/>
                    <h:outputLabel for="txtEmpaques" value="Empaques a Entregar:" />
                    <p:inputText id="txtEmpaques" maxlength="10" value="#{beanEntregaMercancia.empaquesEntregar}" >
                        <p:ajax event="blur"
                                listener="#{beanEntregaMercancia.setKilosPromedio}"
                                immediate="true" update="txtKilos"/>
                    </p:inputText>
                    <h:outputLabel for="txtKilos" value="Kilos a Entregar:" />
                    <p:inputText id="txtKilos" maxlength="10" value="#{beanEntregaMercancia.kilosEntrega}" >
                        <pe:keyFilter regEx="/[0-9_ .]/i"/>
                    </p:inputText>
                    <h:outputLabel for="txtcomentario" value="Comentarios:" />
                    <p:inputText id="txtcomentario" maxlength="255" value="#{beanEntregaMercancia.observaciones}" />

                </h:panelGrid>
            </p:dialog>
            <iframe id="miFrame" name="miFrame" style="position: absolute;" class="hidden" src="#{beanEntregaMercancia.rutaPDF}"/>
        </h:form>
    </ui:define>
</ui:composition>